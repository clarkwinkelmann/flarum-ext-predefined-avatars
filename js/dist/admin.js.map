{"version":3,"sources":["webpack://@clarkwinkelmann/predefined-avatars/webpack/bootstrap","webpack://@clarkwinkelmann/predefined-avatars/external \"flarum.core.compat['common/components/Button']\"","webpack://@clarkwinkelmann/predefined-avatars/external \"flarum.core.compat['common/helpers/icon']\"","webpack://@clarkwinkelmann/predefined-avatars/./src/admin/components/Sortable.ts","webpack://@clarkwinkelmann/predefined-avatars/./src/admin/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","flarum","core","compat","Sortable","sortingIndex","showPlaceholderForIndex","dragoverenterhandler","drophandler","oncreate","vnode","this","event","preventDefault","stopPropagation","dataTransfer","dropEffect","targetIndex","dom","childNodes","forEach","element","index","parseInt","dataset","isNaN","position","getBoundingClientRect","attrs","direction","width","middleX","left","pageX","window","scrollX","height","middleY","top","pageY","scrollY","redraw","document","addEventListener","origin","destination","onsort","onremove","removeEventListener","view","children","content","push","placeholder","style","display","ondragstart","target","classList","contains","disabled","Array","from","find","elem","effectAllowed","setData","setDragImage","length","containerTag","placeholderTag","className","colspan","app","initializers","add","uploading","extensionData","registerSetting","setting","type","label","translator","trans","help","options","none","first","random","default","avatars","rawAvatars","JSON","parse","error","console","isArray","splice","stringify","map","avatar","draggable","src","forum","attribute","alt","Button","component","icon","onclick","href","$","appendTo","hide","click","on","body","FormData","append","files","request","method","url","serialize","raw","then","response","path","registerPermission","permission","allowGuest"],"mappings":"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","file":"admin.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n","module.exports = flarum.core.compat['common/components/Button'];","module.exports = flarum.core.compat['common/helpers/icon'];","import {ClassComponent, Vnode, VnodeDOM} from 'mithril';\n\ninterface SortableAttrs {\n    containerTag?: string\n    placeholderTag?: string\n    disabled?: boolean\n    direction?: 'vertical' | 'horizontal'\n    onsort: (origin: number, destination: number) => void,\n}\n\n/**\n * A sortable implementation inspired by html5sortable, but designed to work with Mithril\n * The sortable children must be a flat array of vnodes and be keyed\n * Copied from flamarkt/core\n */\nexport default class Sortable implements ClassComponent<SortableAttrs> {\n    sortingIndex: number | null = null;\n    showPlaceholderForIndex: number = 0;\n\n    dragoverenterhandler!: (event: DragEvent) => void;\n    drophandler!: (event: DragEvent) => void;\n\n    oncreate(vnode: VnodeDOM<SortableAttrs>) {\n        // We need to handle both dragover and dragenter to prevent inputs from showing a cursor when hovered\n        // We also need this event to handle mouse movement because stopping propagation seems to stop mousemove event\n        this.dragoverenterhandler = event => {\n            if (this.sortingIndex !== null) {\n                event.preventDefault();\n                event.stopPropagation();\n                // @ts-ignore dataTransfer could be null... but not sure when that could happen\n                event.dataTransfer.dropEffect = 'move';\n\n                let targetIndex = 0;\n\n                // We will show the placeholder above or below the hovered item using the middle height as criteria\n                (vnode.dom.childNodes as any as HTMLElement[]).forEach(element => {\n                    const index = parseInt(element.dataset.index || '');\n\n                    // Ignore elements without an index (those will be the placeholders)\n                    if (isNaN(index)) {\n                        return;\n                    }\n\n                    const position = element.getBoundingClientRect();\n\n                    if (vnode.attrs.direction === 'horizontal') {\n                        // Ignore invisible elements\n                        if (!position.width) {\n                            return;\n                        }\n\n                        const middleX = position.left + (position.width / 2);\n\n                        if (event.pageX > middleX + window.scrollX) {\n                            targetIndex = index + 1;\n                        }\n                    } else {\n                        // Ignore invisible elements\n                        if (!position.height) {\n                            return;\n                        }\n\n                        const middleY = position.top + (position.height / 2);\n\n                        if (event.pageY > middleY + window.scrollY) {\n                            targetIndex = index + 1;\n                        }\n                    }\n                });\n\n                if (targetIndex !== this.showPlaceholderForIndex) {\n                    this.showPlaceholderForIndex = targetIndex;\n                    m.redraw();\n                }\n            }\n        };\n\n        document.addEventListener('dragover', this.dragoverenterhandler);\n        document.addEventListener('dragenter', this.dragoverenterhandler);\n\n        // Prevent dropping our sortable item into anything else\n        // Without this it's possible to drop the value into inputs or worse, cause the browser to navigate to 0.0.0.0\n        this.drophandler = event => {\n            if (this.sortingIndex !== null) {\n                event.preventDefault();\n                event.stopPropagation();\n\n                const origin = this.sortingIndex;\n                // This component works in reference to the original index, so there are always two possible placeholders\n                // in between the moved component. However we want to send the new index without that space\n                const destination = this.showPlaceholderForIndex - (this.showPlaceholderForIndex > this.sortingIndex ? 1 : 0);\n\n                this.sortingIndex = null;\n                m.redraw();\n\n                if (destination !== origin) {\n                    vnode.attrs.onsort(origin, destination);\n                }\n            }\n        };\n\n        document.addEventListener('drop', this.drophandler);\n    }\n\n    onremove() {\n        document.removeEventListener('dragover', this.dragoverenterhandler);\n        document.removeEventListener('dragenter', this.dragoverenterhandler);\n        document.removeEventListener('drop', this.drophandler);\n    }\n\n    view(vnode: Vnode<SortableAttrs>) {\n        const children: Vnode[] = [];\n\n        (vnode.children as Vnode<any>[]).forEach((content, index) => {\n            if (this.sortingIndex !== null && this.showPlaceholderForIndex === index) {\n                children.push(this.placeholder(vnode));\n            }\n\n            if (index === this.sortingIndex) {\n                if (!content.attrs.style) {\n                    content.attrs.style = {};\n                }\n\n                content.attrs.style.display = 'none';\n            }\n\n            content.attrs['data-index'] = index;\n            content.attrs.ondragstart = event => {\n                if (event.target.classList.contains('js-handle') && !vnode.attrs.disabled) {\n                    const element = Array.from((vnode as any as VnodeDOM).dom.childNodes as any as HTMLElement[]).find(elem => elem.dataset.index === index + '');\n\n                    // This should usually not happen since all referenced indexes should exist\n                    // But this pleases typescript\n                    if (!element) {\n                        return;\n                    }\n\n                    const position = element.getBoundingClientRect();\n\n                    event.dataTransfer.effectAllowed = 'move';\n                    event.dataTransfer.setData('text/plain', index + ''); // Cast to string\n                    event.dataTransfer.setDragImage(element, event.pageX - position.left - window.scrollX, event.pageY - position.top - window.scrollY);\n\n                    this.sortingIndex = index;\n                    this.showPlaceholderForIndex = index;\n                } else {\n                    event.redraw = false;\n                }\n            };\n\n            children.push(content);\n        });\n\n        if (this.sortingIndex !== null && this.showPlaceholderForIndex === (vnode.children as Vnode[]).length) {\n            children.push(this.placeholder(vnode));\n        }\n\n        return m(vnode.attrs.containerTag || 'div', children);\n    }\n\n    placeholder(vnode: Vnode<SortableAttrs>): Vnode {\n        return m(vnode.attrs.placeholderTag || 'div', {\n            className: 'SortablePlaceholder',\n            key: 'placeholder',\n        }, vnode.attrs.placeholderTag === 'tr' ? m('td', {\n            colspan: 100,\n        }) : null);\n    }\n}\n","import Button from 'flarum/common/components/Button';\nimport icon from 'flarum/common/helpers/icon';\nimport Sortable from './components/Sortable';\n\n/* global app, m */\n\napp.initializers.add('clarkwinkelmann-predefined-avatars', () => {\n    let uploading = false;\n\n    app.extensionData\n        .for('clarkwinkelmann-predefined-avatars')\n        .registerSetting({\n            setting: 'predefinedAvatarsOnly',\n            type: 'switch',\n            label: app.translator.trans('clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatarsOnly'),\n            help: app.translator.trans('clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatarsOnlyHelp'),\n        })\n        .registerSetting({\n            setting: 'predefinedAvatarsNoRemove',\n            type: 'switch',\n            label: app.translator.trans('clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatarsNoRemove'),\n            help: app.translator.trans('clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatarsNoRemoveHelp'),\n        })\n        .registerSetting({\n            setting: 'predefinedAvatarsDefault',\n            type: 'select',\n            options: {\n                none: app.translator.trans('clarkwinkelmann-predefined-avatars.admin.settings.defaultOptions.none'),\n                first: app.translator.trans('clarkwinkelmann-predefined-avatars.admin.settings.defaultOptions.first'),\n                random: app.translator.trans('clarkwinkelmann-predefined-avatars.admin.settings.defaultOptions.random'),\n            },\n            default: 'none',\n            label: app.translator.trans('clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatarsDefault'),\n            help: app.translator.trans('clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatarsDefaultHelp'),\n        })\n        .registerSetting(function () {\n            const rawAvatars = this.setting('predefinedAvatars')();\n\n            let avatars;\n\n            try {\n                avatars = JSON.parse(rawAvatars);\n            } catch (error) {\n                console.error('Invalid JSON for predefinedAvatars settings');\n                // ignore JSON parsing errors\n            }\n\n            if (!Array.isArray(avatars)) {\n                avatars = [];\n            }\n\n            return m('.Form-group', [\n                m('label', app.translator.trans('clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatars')),\n                m('.helpText', app.translator.trans('clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatarsHelp')),\n                m(Sortable, {\n                    containerTag: 'ul.PredefinedAvatars',\n                    placeholderTag: 'li.Avatar.Avatar--predefined.Avatar--placeholder',\n                    direction: 'horizontal',\n                    onsort: (origin, destination) => {\n                        // Because the \"add\" button is inside of the Sortable component\n                        // it's possible to drop an avatar after the last place, which wouldn't work\n                        if (destination >= avatars.length) {\n                            destination = avatars.length - 1;\n                        }\n\n                        avatars.splice(destination, 0, ...avatars.splice(origin, 1));\n                        this.setting('predefinedAvatars')(JSON.stringify(avatars));\n                    },\n                }, [\n                    ...avatars.map((avatar, index) => m('li', {\n                        key: avatar,\n                    }, [\n                        m('.Avatar.Avatar--predefined.js-handle', {\n                            draggable: true,\n                        }, m('img', {\n                            src: app.forum.attribute('predefinedAvatarsPrefix') + avatar,\n                            alt: avatar,\n                            draggable: false, // The img becomes the target of the dragstart event if it doesn't have this\n                        })),\n                        Button.component({\n                            className: 'Button Button--icon Button--delete',\n                            icon: 'fas fa-times',\n                            onclick: () => {\n                                avatars.splice(index, 1);\n                                this.setting('predefinedAvatars')(JSON.stringify(avatars));\n                            },\n                        }),\n                    ])),\n                    m('li', {\n                        key: 'add',\n                    }, m('a.Avatar.Avatar--predefined.UploadButton', {\n                        href: '#',\n                        onclick: event => {\n                            event.preventDefault();\n\n                            const $input = $('<input type=\"file\">');\n\n                            $input\n                                .appendTo('body')\n                                .hide()\n                                .click()\n                                .on('change', event => {\n                                    const body = new FormData();\n                                    body.append('avatar', event.target.files[0]);\n\n                                    uploading = true;\n                                    m.redraw();\n\n                                    app\n                                        .request({\n                                            method: 'POST',\n                                            url: app.forum.attribute('apiUrl') + '/predefined-avatar-upload',\n                                            serialize: (raw) => raw,\n                                            body,\n                                        })\n                                        .then(response => {\n                                            avatars.push(response.path);\n                                            this.setting('predefinedAvatars')(JSON.stringify(avatars));\n                                            uploading = false;\n                                            m.redraw();\n                                        }, error => {\n                                            uploading = false;\n                                            m.redraw();\n\n                                            throw error;\n                                        });\n                                });\n                        },\n                        disabled: uploading,\n                    }, icon(uploading ? 'fas fa-spinner fa-pulse' : 'fas fa-plus'))),\n                ]),\n            ]);\n        })\n        .registerPermission({\n            icon: 'fas fa-user-circle',\n            label: app.translator.trans('clarkwinkelmann-predefined-avatars.admin.permissions.setPredefinedAvatar'),\n            permission: 'user.setPredefinedAvatar',\n            allowGuest: true, // We allow \"guest\" so you can give this permission to suspended/non-activated users\n        }, 'reply')\n        .registerPermission({\n            icon: 'fas fa-user-circle',\n            label: app.translator.trans('clarkwinkelmann-predefined-avatars.admin.permissions.setCustomAvatarAlways'),\n            permission: 'user.setCustomAvatarAlways',\n        }, 'moderate');\n});\n"],"sourceRoot":""}