module.exports=function(e){var r={};function t(a){if(r[a])return r[a].exports;var n=r[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,t),n.l=!0,n.exports}return t.m=e,t.c=r,t.d=function(e,r,a){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:a})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)t.d(a,n,function(r){return e[r]}.bind(null,n));return a},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=8)}([function(e,r){e.exports=flarum.core.compat["admin/app"]},,function(e,r){e.exports=flarum.core.compat["common/components/Button"]},,,,function(e,r){e.exports=flarum.core.compat["common/helpers/icon"]},,function(e,r,t){"use strict";t.r(r);var a=t(0),n=t.n(a),i=t(2),o=t.n(i),s=t(6),d=t.n(s),l=function(){function e(){this.sortingIndex=null,this.showPlaceholderForIndex=0,this.dragoverenterhandler=void 0,this.drophandler=void 0}var r=e.prototype;return r.oncreate=function(e){var r=this;this.dragoverenterhandler=function(t){if(null!==r.sortingIndex){t.preventDefault(),t.stopPropagation(),t.dataTransfer.dropEffect="move";var a=0;e.dom.childNodes.forEach((function(r){var n=parseInt(r.dataset.index||"");if(!isNaN(n)){var i=r.getBoundingClientRect();if("horizontal"===e.attrs.direction){if(!i.width)return;var o=i.left+i.width/2;t.pageX>o+window.scrollX&&(a=n+1)}else{if(!i.height)return;var s=i.top+i.height/2;t.pageY>s+window.scrollY&&(a=n+1)}}})),a!==r.showPlaceholderForIndex&&(r.showPlaceholderForIndex=a,m.redraw())}},document.addEventListener("dragover",this.dragoverenterhandler),document.addEventListener("dragenter",this.dragoverenterhandler),this.drophandler=function(t){if(null!==r.sortingIndex){t.preventDefault(),t.stopPropagation();var a=r.sortingIndex,n=r.showPlaceholderForIndex-(r.showPlaceholderForIndex>r.sortingIndex?1:0);r.sortingIndex=null,m.redraw(),n!==a&&e.attrs.onsort(a,n)}},document.addEventListener("drop",this.drophandler)},r.onremove=function(){document.removeEventListener("dragover",this.dragoverenterhandler),document.removeEventListener("dragenter",this.dragoverenterhandler),document.removeEventListener("drop",this.drophandler)},r.view=function(e){var r=this,t=[];return e.children.forEach((function(a,n){null!==r.sortingIndex&&r.showPlaceholderForIndex===n&&t.push(r.placeholder(e)),n===r.sortingIndex&&(a.attrs.style||(a.attrs.style={}),a.attrs.style.display="none"),a.attrs["data-index"]=n,a.attrs.ondragstart=function(t){if(t.target&&t.dataTransfer)if(t.target.classList.contains("js-handle")&&!e.attrs.disabled){var a=Array.from(e.dom.childNodes).find((function(e){return e.dataset.index===n+""}));if(!a)return;var i=a.getBoundingClientRect();t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",n+""),t.dataTransfer.setDragImage(a,t.pageX-i.left-window.scrollX,t.pageY-i.top-window.scrollY),r.sortingIndex=n,r.showPlaceholderForIndex=n}else t.redraw=!1},t.push(a)})),null!==this.sortingIndex&&this.showPlaceholderForIndex===e.children.length&&t.push(this.placeholder(e)),m(e.attrs.containerTag||"div",t)},r.placeholder=function(e){return m(e.attrs.placeholderTag||"div",{className:"SortablePlaceholder",key:"placeholder"},"tr"===e.attrs.placeholderTag?m("td",{colspan:100}):null)},e}();n.a.initializers.add("clarkwinkelmann-predefined-avatars",(function(){var e=!1;n.a.extensionData.for("clarkwinkelmann-predefined-avatars").registerSetting({setting:"predefinedAvatarsOnly",type:"switch",label:n.a.translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatarsOnly"),help:n.a.translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatarsOnlyHelp")}).registerSetting({setting:"predefinedAvatarsNoRemove",type:"switch",label:n.a.translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatarsNoRemove"),help:n.a.translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatarsNoRemoveHelp")}).registerSetting({setting:"predefinedAvatarsDefault",type:"select",options:{none:n.a.translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.defaultOptions.none"),first:n.a.translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.defaultOptions.first"),random:n.a.translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.defaultOptions.random")},default:"none",label:n.a.translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatarsDefault"),help:n.a.translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatarsDefaultHelp")}).registerSetting((function(){var r=this,t=this.setting("predefinedAvatars")(),a=[];try{a=JSON.parse(t)}catch(e){console.error("Invalid JSON for predefinedAvatars settings")}return Array.isArray(a)||(a=[]),m(".Form-group",[m("label",n.a.translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatars")),m(".helpText",n.a.translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatarsHelp")),m(l,{containerTag:"ul.PredefinedAvatars",placeholderTag:"li.Avatar.Avatar--predefined.Avatar--placeholder",direction:"horizontal",onsort:function(e,t){var n;t>=a.length&&(t=a.length-1),(n=a).splice.apply(n,[t,0].concat(a.splice(e,1))),r.setting("predefinedAvatars")(JSON.stringify(a))}},[].concat(a.map((function(e,t){return m("li",{key:e},[m(".Avatar.Avatar--predefined.js-handle",{draggable:!0},m("img",{src:n.a.forum.attribute("predefinedAvatarsPrefix")+e,alt:e,draggable:!1})),o.a.component({className:"Button Button--icon Button--delete",icon:"fas fa-times",onclick:function(){a.splice(t,1),r.setting("predefinedAvatars")(JSON.stringify(a))}})])})),[m("li",{key:"add"},m("a.Avatar.Avatar--predefined.UploadButton",{href:"#",onclick:function(t){t.preventDefault(),$('<input type="file">').appendTo("body").hide().trigger("click").on("change",(function(t){var i=new FormData;i.append("avatar",t.target.files[0]),e=!0,m.redraw(),n.a.request({method:"POST",url:n.a.forum.attribute("apiUrl")+"/predefined-avatar-upload",serialize:function(e){return e},body:i}).then((function(t){a.push(t.path),r.setting("predefinedAvatars")(JSON.stringify(a)),e=!1,m.redraw()}),(function(r){throw e=!1,m.redraw(),r}))}))},disabled:e},d()(e?"fas fa-spinner fa-pulse":"fas fa-plus")))]))])})).registerPermission({icon:"fas fa-user-circle",label:n.a.translator.trans("clarkwinkelmann-predefined-avatars.admin.permissions.setPredefinedAvatar"),permission:"user.setPredefinedAvatar",allowGuest:!0},"reply").registerPermission({icon:"fas fa-user-circle",label:n.a.translator.trans("clarkwinkelmann-predefined-avatars.admin.permissions.setCustomAvatarAlways"),permission:"user.setCustomAvatarAlways"},"moderate")}))}]);
//# sourceMappingURL=admin.js.map