(()=>{var e={n:r=>{var a=r&&r.__esModule?()=>r.default:()=>r;return e.d(a,{a}),a},d:(r,a)=>{for(var t in a)e.o(a,t)&&!e.o(r,t)&&Object.defineProperty(r,t,{enumerable:!0,get:a[t]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},r={};(()=>{"use strict";e.r(r);const a=flarum.core.compat["admin/app"];var t=e.n(a);const n=flarum.core.compat["common/components/Button"];var i=e.n(n);const s=flarum.core.compat["common/helpers/icon"];var d=e.n(s),o=function(){function e(){this.sortingIndex=null,this.showPlaceholderForIndex=0,this.dragoverenterhandler=void 0,this.drophandler=void 0}var r=e.prototype;return r.oncreate=function(e){var r=this;this.dragoverenterhandler=function(a){if(null!==r.sortingIndex){a.preventDefault(),a.stopPropagation(),a.dataTransfer.dropEffect="move";var t=0;e.dom.childNodes.forEach((function(r){var n=parseInt(r.dataset.index||"");if(!isNaN(n)){var i=r.getBoundingClientRect();if("horizontal"===e.attrs.direction){if(!i.width)return;var s=i.left+i.width/2;a.pageX>s+window.scrollX&&(t=n+1)}else{if(!i.height)return;var d=i.top+i.height/2;a.pageY>d+window.scrollY&&(t=n+1)}}})),t!==r.showPlaceholderForIndex&&(r.showPlaceholderForIndex=t,m.redraw())}},document.addEventListener("dragover",this.dragoverenterhandler),document.addEventListener("dragenter",this.dragoverenterhandler),this.drophandler=function(a){if(null!==r.sortingIndex){a.preventDefault(),a.stopPropagation();var t=r.sortingIndex,n=r.showPlaceholderForIndex-(r.showPlaceholderForIndex>r.sortingIndex?1:0);r.sortingIndex=null,m.redraw(),n!==t&&e.attrs.onsort(t,n)}},document.addEventListener("drop",this.drophandler)},r.onremove=function(){document.removeEventListener("dragover",this.dragoverenterhandler),document.removeEventListener("dragenter",this.dragoverenterhandler),document.removeEventListener("drop",this.drophandler)},r.view=function(e){var r=this,a=[];return e.children.forEach((function(t,n){null!==r.sortingIndex&&r.showPlaceholderForIndex===n&&a.push(r.placeholder(e)),n===r.sortingIndex&&(t.attrs.style||(t.attrs.style={}),t.attrs.style.display="none"),t.attrs["data-index"]=n,t.attrs.ondragstart=function(a){if(a.target&&a.dataTransfer)if(a.target.classList.contains("js-handle")&&!e.attrs.disabled){var t=Array.from(e.dom.childNodes).find((function(e){return e.dataset.index===n+""}));if(!t)return;var i=t.getBoundingClientRect();a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("text/plain",n+""),a.dataTransfer.setDragImage(t,a.pageX-i.left-window.scrollX,a.pageY-i.top-window.scrollY),r.sortingIndex=n,r.showPlaceholderForIndex=n}else a.redraw=!1},a.push(t)})),null!==this.sortingIndex&&this.showPlaceholderForIndex===e.children.length&&a.push(this.placeholder(e)),m(e.attrs.containerTag||"div",a)},r.placeholder=function(e){return m(e.attrs.placeholderTag||"div",{className:"SortablePlaceholder",key:"placeholder"},"tr"===e.attrs.placeholderTag?m("td",{colspan:100}):null)},e}();t().initializers.add("clarkwinkelmann-predefined-avatars",(function(){var e=!1;t().extensionData.for("clarkwinkelmann-predefined-avatars").registerSetting({setting:"predefinedAvatarsOnly",type:"switch",label:t().translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatarsOnly"),help:t().translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatarsOnlyHelp")}).registerSetting({setting:"predefinedAvatarsNoRemove",type:"switch",label:t().translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatarsNoRemove"),help:t().translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatarsNoRemoveHelp")}).registerSetting({setting:"predefinedAvatarsDefault",type:"select",options:{none:t().translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.defaultOptions.none"),first:t().translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.defaultOptions.first"),random:t().translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.defaultOptions.random")},default:"none",label:t().translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatarsDefault"),help:t().translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatarsDefaultHelp")}).registerSetting((function(){var r=this,a=this.setting("predefinedAvatars")(),n=[];try{n=JSON.parse(a)}catch(e){console.error("Invalid JSON for predefinedAvatars settings")}return Array.isArray(n)||(n=[]),m(".Form-group",[m("label",t().translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatars")),m(".helpText",t().translator.trans("clarkwinkelmann-predefined-avatars.admin.settings.predefinedAvatarsHelp")),m(o,{containerTag:"ul.PredefinedAvatars",placeholderTag:"li.Avatar.Avatar--predefined.Avatar--placeholder",direction:"horizontal",onsort:function(e,a){var t;a>=n.length&&(a=n.length-1),(t=n).splice.apply(t,[a,0].concat(n.splice(e,1))),r.setting("predefinedAvatars")(JSON.stringify(n))}},[].concat(n.map((function(e,a){return m("li",{key:e},[m(".Avatar.Avatar--predefined.js-handle",{draggable:!0},m("img",{src:t().forum.attribute("predefinedAvatarsPrefix")+e,alt:e,draggable:!1})),i().component({className:"Button Button--icon Button--delete",icon:"fas fa-times",onclick:function(){n.splice(a,1),r.setting("predefinedAvatars")(JSON.stringify(n))}})])})),[m("li",{key:"add"},m("a.Avatar.Avatar--predefined.UploadButton",{href:"#",onclick:function(a){a.preventDefault(),$('<input type="file">').appendTo("body").hide().trigger("click").on("change",(function(a){var i=new FormData;i.append("avatar",a.target.files[0]),e=!0,m.redraw(),t().request({method:"POST",url:t().forum.attribute("apiUrl")+"/predefined-avatar-upload",serialize:function(e){return e},body:i}).then((function(a){n.push(a.path),r.setting("predefinedAvatars")(JSON.stringify(n)),e=!1,m.redraw()}),(function(r){throw e=!1,m.redraw(),r}))}))},disabled:e},d()(e?"fas fa-spinner fa-pulse":"fas fa-plus")))]))])})).registerPermission({icon:"fas fa-user-circle",label:t().translator.trans("clarkwinkelmann-predefined-avatars.admin.permissions.setPredefinedAvatar"),permission:"user.setPredefinedAvatar",allowGuest:!0},"reply").registerPermission({icon:"fas fa-user-circle",label:t().translator.trans("clarkwinkelmann-predefined-avatars.admin.permissions.setCustomAvatarAlways"),permission:"user.setCustomAvatarAlways"},"moderate")}))})(),module.exports=r})();
//# sourceMappingURL=admin.js.map